<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>이메일 인증</title>
  <link th:href="@{/css/base/nav.css}" rel="stylesheet">
  <link th:href="@{/css/signup/email.css}" rel="stylesheet">
  <style>
    .emailbox {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    #sendAuthCode {
      margin-left: 10px;
    }
  </style>
</head>
<body>
<!-- 배경 이미지 -->
<img th:src="@{/images/signup/Signup.png}" alt="mainpage" class="bg">

<header>
  <nav>
    <span>WashPlan</span>
    <span>예약</span>
    <span>FAQ</span>
    <span style="color: #FFFF00">회원가입</span>
    <span>로그인</span>
  </nav>
</header>

<main>
  <span class="emaillogo">이메일 인증</span>
  <span class="emaildetail">회원가입을 위해 이메일 인증을 진행합니다.</span>

  <div class="emailbox">
    <label for="emailinput">이메일: </label>
    <input type="text" id="emailinput" placeholder="아이디">
    @
    <input type="text" id="customDomain" placeholder="도메인 입력">
    <select id="emailDomain">
      <option value="custom" selected>직접 입력</option>
      <option value="naver.com">naver.com</option>
      <option value="gmail.com">gmail.com</option>
      <option value="daum.net">daum.net</option>
    </select>
  </div>
  <button id="sendAuthCode">인증번호 전송</button>

  <div class="codebox" style="margin-top: 10px;">
    <label for="codeinput">인증번호: </label>
    <input type="text" id="codeinput">
  </div>
  <button id="confirm">코드 확인</button>

  <script>
    const emailDomain = document.getElementById('emailDomain');
    const customDomain = document.getElementById('customDomain');

    // 도메인 선택 변경 이벤트
    emailDomain.addEventListener('change', () => {
      if (emailDomain.value === 'custom') {
        customDomain.disabled = false;
        customDomain.value = '';
        customDomain.focus();
      } else {
        customDomain.disabled = true;
        customDomain.value = emailDomain.value;
      }
    });

    // 인증번호 전송 요청
    document.getElementById('sendAuthCode').addEventListener('click', () => {
      const emailInput = document.getElementById('emailinput').value;
      const domain =
              emailDomain.value === 'custom' ? customDomain.value : emailDomain.value;

      const email = `${emailInput}@${domain}`;

      if (!emailInput || !domain || !domain.includes('.')) {
        alert('올바른 이메일 주소를 입력하세요.');
        return;
      }

      fetch('/email/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email })
      })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  alert('인증번호가 전송되었습니다.');
                } else {
                  alert('인증번호 전송에 실패했습니다.');
                }
              })
              .catch(err => console.error('Error:', err));
    });

    // 인증번호 확인 요청
    document.getElementById('confirm').addEventListener('click', () => {
      const emailInput = document.getElementById('emailinput').value;
      const domain =
              emailDomain.value === 'custom' ? customDomain.value : emailDomain.value;

      const email = `${emailInput}@${domain}`;
      const code = document.getElementById('codeinput').value;

      if (!code) {
        alert('인증번호를 입력하세요.');
        return;
      }

      fetch('/email/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, code: code })
      })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  alert('인증이 완료되었습니다.');
                } else {
                  alert('인증번호가 올바르지 않습니다.');
                }
              })
              .catch(err => console.error('Error:', err));
    });
  </script>
</main>
</body>
</html>