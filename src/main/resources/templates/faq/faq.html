<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>FAQ</title>
    <link th:href="@{/css/base/nav.css}" rel="stylesheet">
    <link th:href="@{/css/faq/faq.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}">
</head>
<body>
<!-- 배경 이미지 -->
<img th:src="@{/images/main/FAQ.png}" alt="mainpage" class="bg">

<header>
    <nav>
        <!-- 기본 메뉴 -->
        <span onclick="location.href='/main'">WashPlan</span>
        <span onclick="location.href='/reservation'">예약</span>
        <span onclick="location.href='/faq'" style="color: #FFFF00">FAQ</span>
        
        <!-- 관리자 로그인 시 -->
        <span sec:authorize="hasRole('ROLE_ADMIN')" id="adminTab" class="admin" onclick="toggleAdminMenu()">관리자</span>
        <span sec:authorize="hasRole('ROLE_ADMIN')" onclick="location.href='/logout'">로그아웃</span>
        
        <!-- 관리자 메뉴 -->
        <div sec:authorize="hasRole('ROLE_ADMIN')" class="admin-menu" id="adminMenu" style="display: none;">
            <button onclick="location.href='/admin'" class="adminMain">관리자 메인</button>
            <button onclick="location.href='/admin/adminuser'" class="adminUser">사용자 관리</button>
            <button onclick="location.href='/admin/adminmachine'" class="adminMachine">세탁기/건조기 관리</button>
            <button onclick="location.href='/admin/admininquiry'" class="adminInquiry">문의사항 관리</button>
            <button onclick="location.href='/admin/adminnotice'" class="adminNotice">공지사항 관리</button>
        </div>
        
        <!-- 일반 사용자 로그인 시 -->
        <span sec:authorize="hasRole('ROLE_USER')" onclick="location.href='/mypage'">마이페이지</span>
        <span sec:authorize="hasRole('ROLE_USER')" onclick="location.href='/logout'">로그아웃</span>
        
        <!-- 로그인하지 않은 경우 -->
        <span sec:authorize="isAnonymous()" onclick="location.href='/signup/agree'">회원가입</span>
        <span sec:authorize="isAnonymous()" onclick="location.href='/login'">로그인</span>
    </nav>
</header>

<main>
    <button class="faqBtn" onclick="location.href='faq'">FAQ</button>
    <button class="noticeBtn" onclick="location.href='notice'">공지사항</button>


    <div class="DivQ1">
        <img th:src="@{/images/main/Q.png}" alt="QImage" class="Q1">
        <p class="QP1">예약은 어떻게 하나요?</p>
    </div>

    <div class="DivA1">
        <img th:src="@{/images/main/A.png}" alt="AImage" class="A1">
        <p class="AP1">예약 페이지에서 원하는 날짜와 시간을 선택하고, 사용 가능한 세탁기나 건조기를 예약하시면 됩니다.<br>
            기기의 상태는 실시간으로 업데이트됩니다.
        </p>
    </div>

    <hr class="custom-line1">

    <div class="DivQ2">
        <img th:src="@{/images/main/Q.png}" alt="QImage" class="Q2">
        <p class="QP2">예약 가능한 기기 목록은 어떻게 확인하나요?</p>
    </div>

    <div class="DivA2">
        <img th:src="@{/images/main/A.png}" alt="AImage" class="A2">
        <p class="AP2">예약 페이지에서 사용 가능한 세탁기와 건조기의 상태를 실시간으로 확인하실 수 있습니다.</p>
    </div>
    <hr class="custom-line2">


    <div class="DivQ3">
        <img th:src="@{/images/main/Q.png}" alt="QImage" class="Q3">
        <p class="QP3">세탁기와 건조기의 옵션은 무엇인가요?</p>
    </div>

    <div class="DivA3">
        <img th:src="@{/images/main/A.png}" alt="AImage" class="A3">
        <p class="AP3">세탁기는 표준세탁(30분)과 침구세탁(40분) 옵션이 있으며, 건조기는 소량건조(30분)와 표준건조<br>(40분) 옵션이 제공됩니다.
        </p>
    </div>

    <hr class="custom-line3">

    <div class="DivQ4">
        <img th:src="@{/images/main/Q.png}" alt="QImage" class="Q4">
        <p class="QP4">예약 시간이 10분 단위로 제한되는데, 왜 그런가요?</p>
    </div>

    <div class="DivA4">
        <img th:src="@{/images/main/A.png}" alt="AImage" class="A4">
        <p class="AP4">예약은 10분 단위로 가능합니다. 옵션 시간에 10분을 더한 후 예약을 잠그는 시스템으로,  효율적인<br>
            예약 관리를 위해 설정되었습니다.
        </p>
    </div>

    <hr class="custom-line4">

    <div class="DivQ5">
        <img th:src="@{/images/main/Q.png}" alt="QImage" class="Q5">
        <p class="QP5">다른 사람이 내 예약을 볼 수 있나요?</p>
    </div>

    <div class="DivA5">
        <img th:src="@{/images/main/A.png}" alt="AImage" class="A5">
        <p class="AP5">다른 사용자는 예약된 시간대와 기기의 상태는 확인할 수 있지만, 예약자 정보는 볼 수 없습니다.</p>
    </div>

    <p class="p1">도움말을 통해 문제를 해결하지 못하셨나요?</p>

    <div class="DivIq">
        <img th:src="@{/images/main/iq.png}" alt="AImage" class="Iq">
        <p class="IqP1">문의하기<br>
            <br>
            마이페이지에서 답변을 받을 수 있습니다.</p>
    </div>

    <!-- 문의하기 팝업 -->
    <div id="inquiryModal" class="modal" style="display: none;">
        <div class="modal-inquiryContent">
            <span class="modalInquiryTitle">문의하기</span>
            <span class="modalTitleText">제목</span>
            <input type="text" class="inquiryTitleInput" id="inquiryTitleInput" placeholder="제목을 입력하세요">
            <span class="modalContentText">내용</span>
            <textarea class="inquiryContentInput" id="inquiryContentInput" placeholder="내용을 입력하세요"></textarea>
            <button id="inquiryCancelButton" class="cancelInquiry">취소</button>
            <button id="sendInquiryButton" class="sendInquiry">등록</button>
        </div>
    </div>

    <!-- 문의 등록 확인 모달 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <p class="modal-text">문의를 등록하시겠습니까?</p>
            <div class="modal-buttons">
                <button id="modalCancelButton" class="modal-button cancel">취소</button>
                <button id="modalConfirmButton" class="modal-button confirm">확인</button>
            </div>
        </div>
    </div>

    <!-- 등록 완료 모달 -->
    <div id="completeModal" class="modal">
        <div class="modal-content">
            <p class="modal-text">문의가 등록되었습니다.</p>
            <div class="modal-buttons">
                <button id="completeButton" class="modal-button confirm">확인</button>
            </div>
        </div>
    </div>

    <div id="passwordCheckModal" class="modal" style="display: none;">
        <div class="modal-content2">
            <p class="checkP">비밀번호를 입력해주세요.</p>
            <div class="password-input-container">
                <input type="password" id="checkPasswordInput" class="check-password-input">
            </div>
            <img th:src="@{/images/login/Invisible.png}" alt="Invisible" class="password-toggle">
            <div class="modal-buttons2">
                <button id="checkCancelButton" class="modal-btn">취소</button>
                <button id="checkConfirmButton" class="modal-btn">확인</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inquiryDiv = document.querySelector('.DivIq');
            const inquiryModal = document.getElementById('inquiryModal');
            const confirmModal = document.getElementById('confirmModal');
            const completeModal = document.getElementById('completeModal');
            const cancelButton = document.getElementById('inquiryCancelButton');
            const sendButton = document.getElementById('sendInquiryButton');

            // 팝업 열기 함수
            function openModal(modal) {
                modal.style.display = 'block';
                document.body.classList.add('no-scroll'); // 스크롤 비활성화
            }

            // 팝업 닫기 함수
            function closeModal(modal) {
                modal.style.display = 'none';
                document.body.classList.remove('no-scroll'); // 스크롤 활성화
            }

            // 문의하기 DIV 클릭 시 모달 표시
            inquiryDiv.addEventListener('click', () => {
                openModal(inquiryModal);
            });

            // 취소 버튼 클릭 시 모달 닫기
            cancelButton.addEventListener('click', () => {
                closeModal(inquiryModal);
                // 입력 필드 초기화
                document.getElementById('inquiryTitleInput').value = '';
                document.getElementById('inquiryContentInput').value = '';
            });

            // 등록 버튼 클릭 시 확인 모달 표시
            sendButton.addEventListener('click', () => {
                const title = document.getElementById('inquiryTitleInput').value;
                const content = document.getElementById('inquiryContentInput').value;

                if (!title.trim()) {
                    alert('제목을 입력해주세요.');
                    return;
                }
                if (!content.trim()) {
                    alert('내용을 입력해주세요.');
                    return;
                }

                openModal(confirmModal);
            });

            // 확인 모달의 취소 버튼
            document.getElementById('modalCancelButton').addEventListener('click', () => {
                closeModal(confirmModal);
            });

            // 확인 모달의 확인 버튼 - 서버로 데이터 전송
            document.getElementById('modalConfirmButton').addEventListener('click', async () => {
                const title = document.getElementById('inquiryTitleInput').value;
                const content = document.getElementById('inquiryContentInput').value;

                try {
                    const response = await fetch('/inquiry/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            title: title,
                            content: content
                        })
                    });

                    if (response.ok) {
                        closeModal(confirmModal);
                        openModal(completeModal);
                    } else {
                        alert('문의 등록에 실패했습니다.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('문의 등록 중 오류가 발생했습니다.');
                }
            });

            // 완료 모달의 확인 버튼
            document.getElementById('completeButton').addEventListener('click', () => {
                closeModal(completeModal);
                closeModal(inquiryModal);
                // 입력 필드 초기화
                document.getElementById('inquiryTitleInput').value = '';
                document.getElementById('inquiryContentInput').value = '';
            });
        });
    </script>

    <script>
        function toggleAdminMenu() {
            const adminMenu = document.getElementById('adminMenu');
            adminMenu.style.display = adminMenu.style.display === 'none' ? 'block' : 'none';
        }

        // 메뉴 외부 클릭시 닫기
        document.addEventListener('click', function(event) {
            const adminTab = document.getElementById('adminTab');
            const adminMenu = document.getElementById('adminMenu');
            if (adminTab && adminMenu) {
                if (!adminTab.contains(event.target) && !adminMenu.contains(event.target)) {
                    adminMenu.style.display = 'none';
                }
            }
        });

        // 마이페이지 클릭 이벤트 처리
        document.querySelector('span[onclick="location.href=\'/mypage\'"]').onclick = function(e) {
            e.preventDefault(); // 기본 이벤트 중단
            document.getElementById('passwordCheckModal').style.display = 'flex';
        };

        // 비밀번호 토글 기능
        const passwordToggle = document.querySelector('.password-toggle');
        const checkPasswordInput = document.getElementById('checkPasswordInput');
        let isPasswordVisible = false;

        passwordToggle.addEventListener('click', () => {
            isPasswordVisible = !isPasswordVisible;
            checkPasswordInput.type = isPasswordVisible ? 'text' : 'password';
        });

        // 취소 버튼
        document.getElementById('checkCancelButton').onclick = function() {
            document.getElementById('passwordCheckModal').style.display = 'none';
            checkPasswordInput.value = '';
        };

        // 확인 버튼
        document.getElementById('checkConfirmButton').onclick = function() {
            const password = checkPasswordInput.value;

            fetch('/api/user/verify-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: password })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        window.location.href = '/mypage';
                    } else {
                        alert("비밀번호가 일치하지 않습니다.");
                        checkPasswordInput.value = '';
                    }
                })
                .catch(error => {
                    console.error('Error details:', error);
                    console.error('Error message:', error.message);
                    alert(`오류가 발생했습니다: ${error.message}`);
                });
        };

        const body = document.body;

        // 모달 열기 시 스크롤 막기
        document.querySelector('span[onclick="location.href=\'/mypage\'"]').onclick = function(e) {
            e.preventDefault(); // 기본 이벤트 중단
            document.getElementById('passwordCheckModal').style.display = 'flex';
            body.classList.add('modal-open'); // 스크롤 비활성화
        };

        // 모달 닫기 시 스크롤 허용
        document.getElementById('checkCancelButton').onclick = function() {
            document.getElementById('passwordCheckModal').style.display = 'none';
            body.classList.remove('modal-open'); // 스크롤 활성화
            checkPasswordInput.value = '';
        };
    </script>

</main>

<footer>
    <span>📞031-123-4567ㅣ✉️contact@washplan.com</span>
    <span>🚩경기 하남시 미사강변동로 85 힐스테이트 에코 3층</span>
    <span>ⓒ 2024 PPal-AjoㅣAll rights reserved.Designed for your convenience.</span>
</footer>
</body>
</html>