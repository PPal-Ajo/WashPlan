<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>ê³µì§€ì‚¬í•­</title>
    <link th:href="@{/css/base/nav.css}" rel="stylesheet">
    <link th:href="@{/css/faq/notice.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}">
</head>
<body>
<!-- ë°°ê²½ ì´ë¯¸ì§€ -->
<img th:src="@{/images/main/FAQ.png}" alt="mainpage" class="bg">

<header>
    <header>
        <nav>
            <!-- ê¸°ë³¸ ë©”ë‰´ -->
            <span onclick="location.href='/main'">WashPlan</span>
            <span onclick="location.href='/reservation'">ì˜ˆì•½</span>
            <span onclick="location.href='/faq'" style="color: #FFFF00">FAQ</span>

            <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œ -->
            <span sec:authorize="hasRole('ROLE_ADMIN')" id="adminTab" class="admin" onclick="toggleAdminMenu()">ê´€ë¦¬ì</span>
            <span sec:authorize="hasRole('ROLE_ADMIN')" onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</span>

            <!-- ê´€ë¦¬ì ë©”ë‰´ -->
            <div sec:authorize="hasRole('ROLE_ADMIN')" class="admin-menu" id="adminMenu" style="display: none;">
                <button onclick="location.href='/admin'" class="adminMain">ê´€ë¦¬ì ë©”ì¸</button>
                <button onclick="location.href='/admin/adminuser'" class="adminUser">ì‚¬ìš©ì ê´€ë¦¬</button>
                <button onclick="location.href='/admin/adminmachine'" class="adminMachine">ì„¸íƒê¸°/ê±´ì¡°ê¸° ê´€ë¦¬</button>
                <button onclick="location.href='/admin/admininquiry'" class="adminInquiry">ë¬¸ì˜ì‚¬í•­ ê´€ë¦¬</button>
                <button onclick="location.href='/admin/adminnotice'" class="adminNotice">ê³µì§€ì‚¬í•­ ê´€ë¦¬</button>
            </div>

            <!-- ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œ -->
            <span sec:authorize="hasRole('ROLE_USER')" onclick="location.href='/mypage'">ë§ˆì´í˜ì´ì§€</span>
            <span sec:authorize="hasRole('ROLE_USER')" onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</span>

            <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° -->
            <span sec:authorize="isAnonymous()" onclick="location.href='/signup/agree'">íšŒì›ê°€ì…</span>
            <span sec:authorize="isAnonymous()" onclick="location.href='/login'">ë¡œê·¸ì¸</span>
        </nav>
    </header>
</header>

<main>
    <button class="faqBtn" onclick="location.href='/faq'">FAQ</button>
    <button class="noticeBtn" onclick="location.href='/notice'">ê³µì§€ì‚¬í•­</button>

    <div class="nav-header">
        <p class="noNav">ë²ˆí˜¸</p>
        <p class="titleNav">ì œëª©</p>
        <p class="dateNav">ë‚ ì§œ</p>
    </div>
    <hr>

    <div class="notice-list">
        <div th:each="notice, iterStat : ${notices}" class="notice-item">
            <!-- ê³µì§€ì‚¬í•­ ë²ˆí˜¸ë¥¼ ì—°ì†ì ìœ¼ë¡œ í‘œì‹œ -->
            <span class="notice-no" th:text="${notices.size() - iterStat.index}"></span>
            <span class="notice-title" th:text="${notice.noticeTitle}"></span>
            <span class="notice-date" th:text="${#temporals.format(notice.noticeDate, 'yyyy-MM-dd')}"></span>
        </div>
    </div>

    <!-- ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="noticeDetailModal" class="modal">
        <div class="modal-content5">
            <div class="notice-detail">
                <p class="title">ì œëª©</p>
                <div id="modalTitle"></div>
                <p class="content2">ë‚´ìš©</p>
                <div id="modalContent"></div>
                <div class="modal-buttons">
                    <button class="confirm-btn">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì¶”ê°€ -->
    <div id="pagination" class="pagination">
        <button id="prevPage" disabled>â—€ï¸</button>
        <div id="pageNumbers"></div>
        <button id="nextPage" disabled>â–º</button>
    </div>

    <div id="passwordCheckModal" class="modal" style="display: none;">
        <div class="modal-content3">
            <p class="checkP">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <div class="password-input-container">
                <input type="password" id="checkPasswordInput" class="check-password-input">
            </div>
            <img th:src="@{/images/login/Invisible.png}" alt="Invisible" class="password-toggle">
            <div class="modal-buttons2">
                <button id="checkCancelButton" class="modal-btn">ì·¨ì†Œ</button>
                <button id="checkConfirmButton" class="modal-btn">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('noticeDetailModal');

            // ê° ê³µì§€ì‚¬í•­ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.notice-item').forEach(item => {
                item.addEventListener('click', async function() {
                    const noticeTitle = this.querySelector('.notice-title').textContent;
                    try {
                        const response = await fetch(`/notice/detail?title=${encodeURIComponent(noticeTitle)}`);
                        const data = await response.json();

                        // ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸
                        document.getElementById('modalTitle').textContent = data.noticeTitle;
                        document.getElementById('modalContent').textContent = data.noticeContent;

                        // ëª¨ë‹¬ í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ë§‰ê¸°
                        modal.style.display = 'block';
                        document.body.classList.add('no-scroll');
                    } catch (error) {
                        console.error('Error:', error);
                    }
                });
            });

            // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
            document.querySelector('.confirm-btn').addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.classList.remove('no-scroll');
            });



            // í˜ì´ì§€ë„¤ì´ì…˜ ê´€ë ¨ ë³€ìˆ˜
            const itemsPerPage = 10; // í˜ì´ì§€ë‹¹ ë³´ì—¬ì¤„ í•­ëª© ìˆ˜
            const noticeItems = document.querySelectorAll('.notice-item');
            const totalPages = Math.ceil(noticeItems.length / itemsPerPage);
            let currentPage = 1;

            // í˜ì´ì§€ ë²ˆí˜¸ ìƒì„±
            function createPageNumbers() {
                const pageNumbers = document.getElementById('pageNumbers');
                pageNumbers.innerHTML = '';

                for (let i = 1; i <= totalPages; i++) {
                    const button = document.createElement('button');
                    button.className = `page-number ${i === currentPage ? 'active' : ''}`;
                    button.textContent = i;
                    button.onclick = () => goToPage(i);
                    pageNumbers.appendChild(button);
                }
            }

            // í˜ì´ì§€ ì´ë™
            function goToPage(page) {
                currentPage = page;
                updateDisplay();
                updateButtons();
                createPageNumbers();
            }

            // í™”ë©´ ì—…ë°ì´íŠ¸
            function updateDisplay() {
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;

                noticeItems.forEach((item, index) => {
                    item.style.display = (index >= start && index < end) ? '' : 'none';
                });
            }

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            function updateButtons() {
                document.getElementById('prevPage').disabled = currentPage === 1;
                document.getElementById('nextPage').disabled = currentPage === totalPages;
            }

            // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('prevPage').onclick = () => {
                if (currentPage > 1) goToPage(currentPage - 1);
            };

            document.getElementById('nextPage').onclick = () => {
                if (currentPage < totalPages) goToPage(currentPage + 1);
            };

            // ì´ˆê¸° ì„¤ì •
            createPageNumbers();
            updateDisplay();
            updateButtons();
        });
    </script>

    <script>
        function toggleAdminMenu() {
            const adminMenu = document.getElementById('adminMenu');
            adminMenu.style.display = adminMenu.style.display === 'none' ? 'block' : 'none';
        }

        // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const adminTab = document.getElementById('adminTab');
            const adminMenu = document.getElementById('adminMenu');
            if (adminTab && adminMenu) {
                if (!adminTab.contains(event.target) && !adminMenu.contains(event.target)) {
                    adminMenu.style.display = 'none';
                }
            }
        });


        // ë§ˆì´í˜ì´ì§€ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.querySelector('span[onclick="location.href=\'/mypage\'"]').onclick = function(e) {
            e.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ì¤‘ë‹¨
            document.getElementById('passwordCheckModal').style.display = 'flex';
        };

        // ë¹„ë°€ë²ˆí˜¸ í† ê¸€ ê¸°ëŠ¥
        const passwordToggle = document.querySelector('.password-toggle');
        const checkPasswordInput = document.getElementById('checkPasswordInput');
        let isPasswordVisible = false;

        passwordToggle.addEventListener('click', () => {
            isPasswordVisible = !isPasswordVisible;
            checkPasswordInput.type = isPasswordVisible ? 'text' : 'password';
        });

        // ì·¨ì†Œ ë²„íŠ¼
        document.getElementById('checkCancelButton').onclick = function() {
            document.getElementById('passwordCheckModal').style.display = 'none';
            checkPasswordInput.value = '';
        };

        // í™•ì¸ ë²„íŠ¼
        document.getElementById('checkConfirmButton').onclick = function() {
            const password = checkPasswordInput.value;

            fetch('/api/user/verify-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: password })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        window.location.href = '/mypage';
                    } else {
                        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                        checkPasswordInput.value = '';
                    }
                })
                .catch(error => {
                    console.error('Error details:', error);
                    console.error('Error message:', error.message);
                    alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                });
        };

        const body = document.body;

        // ëª¨ë‹¬ ì—´ê¸° ì‹œ ìŠ¤í¬ë¡¤ ë§‰ê¸°
        document.querySelector('span[onclick="location.href=\'/mypage\'"]').onclick = function(e) {
            e.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ì¤‘ë‹¨
            document.getElementById('passwordCheckModal').style.display = 'flex';
            body.classList.add('modal-open'); // ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
        };

        // ëª¨ë‹¬ ë‹«ê¸° ì‹œ ìŠ¤í¬ë¡¤ í—ˆìš©
        document.getElementById('checkCancelButton').onclick = function() {
            document.getElementById('passwordCheckModal').style.display = 'none';
            body.classList.remove('modal-open'); // ìŠ¤í¬ë¡¤ í™œì„±í™”
            checkPasswordInput.value = '';
        };
    </script>

    <!-- ë¬¸ì˜í•˜ê¸° ì„¹ì…˜ ì¶”ê°€ -->
    <p class="p1">ë„ì›€ë§ì„ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ëª»í•˜ì…¨ë‚˜ìš”?</p>

    <div class="DivIq">
        <img th:src="@{/images/main/iq.png}" alt="AImage" class="Iq">
        <p class="IqP1">ë¬¸ì˜í•˜ê¸°<br>
            <br>
            ë§ˆì´í˜ì´ì§€ì—ì„œ ë‹µë³€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ë¬¸ì˜í•˜ê¸° íŒì—… -->
    <div id="inquiryModal" class="modal" style="display: none;">
        <div class="modal-inquiryContent">
            <span class="modalInquiryTitle">ë¬¸ì˜í•˜ê¸°</span>
            <span class="modalTitleText">ì œëª©</span>
            <input type="text" class="inquiryTitleInput" id="inquiryTitleInput" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <span class="modalContentText">ë‚´ìš©</span>
            <textarea class="inquiryContentInput" id="inquiryContentInput" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <button id="inquiryCancelButton" class="cancelInquiry">ì·¨ì†Œ</button>
            <button id="sendInquiryButton" class="sendInquiry">ë“±ë¡</button>
        </div>
    </div>

    <!-- ë¬¸ì˜ ë“±ë¡ í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <p class="modal-text">ë¬¸ì˜ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button id="modalCancelButton" class="modal-button cancel">ì·¨ì†Œ</button>
                <button id="modalConfirmButton" class="modal-button confirm">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ë“±ë¡ ì™„ë£Œ ëª¨ë‹¬ -->
    <div id="completeModal" class="modal">
        <div class="modal-content">
            <p class="modal-text">ë¬¸ì˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <div class="modal-buttons">
                <button id="completeButton" class="modal-button confirm">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inquiryDiv = document.querySelector('.DivIq');
            const inquiryModal = document.getElementById('inquiryModal');
            const confirmModal = document.getElementById('confirmModal');
            const completeModal = document.getElementById('completeModal');
            const cancelButton = document.getElementById('inquiryCancelButton');
            const sendButton = document.getElementById('sendInquiryButton');

            // íŒì—… ì—´ê¸° í•¨ìˆ˜
            function openModal(modal) {
                modal.style.display = 'block';
                document.body.classList.add('no-scroll'); // ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
            }

            // íŒì—… ë‹«ê¸° í•¨ìˆ˜
            function closeModal(modal) {
                modal.style.display = 'none';
                document.body.classList.remove('no-scroll'); // ìŠ¤í¬ë¡¤ í™œì„±í™”
            }

            // ë¬¸ì˜í•˜ê¸° DIV í´ë¦­ ì‹œ ëª¨ë‹¬ í‘œì‹œ
            inquiryDiv.addEventListener('click', () => {
                openModal(inquiryModal);
            });

            // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
            cancelButton.addEventListener('click', () => {
                closeModal(inquiryModal);
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('inquiryTitleInput').value = '';
                document.getElementById('inquiryContentInput').value = '';
            });

            // ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            sendButton.addEventListener('click', () => {
                const title = document.getElementById('inquiryTitleInput').value;
                const content = document.getElementById('inquiryContentInput').value;

                if (!title.trim()) {
                    alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!content.trim()) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                openModal(confirmModal);
            });

            // í™•ì¸ ëª¨ë‹¬ì˜ ì·¨ì†Œ ë²„íŠ¼
            document.getElementById('modalCancelButton').addEventListener('click', () => {
                closeModal(confirmModal);
            });

            // í™•ì¸ ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼ - ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
            document.getElementById('modalConfirmButton').addEventListener('click', async () => {
                const title = document.getElementById('inquiryTitleInput').value;
                const content = document.getElementById('inquiryContentInput').value;

                try {
                    const response = await fetch('/inquiry/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            title: title,
                            content: content
                        })
                    });

                    if (response.ok) {
                        closeModal(confirmModal);
                        openModal(completeModal);
                    } else {
                        alert('ë¬¸ì˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('ë¬¸ì˜ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });

            // ì™„ë£Œ ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
            document.getElementById('completeButton').addEventListener('click', () => {
                closeModal(completeModal);
                closeModal(inquiryModal);
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('inquiryTitleInput').value = '';
                document.getElementById('inquiryContentInput').value = '';
            });
        });
    </script>
</main>

<footer>
    <span>ğŸ“031-123-4567ã…£âœ‰ï¸contact@washplan.com</span>
    <span>ğŸš©ê²½ê¸° í•˜ë‚¨ì‹œ ë¯¸ì‚¬ê°•ë³€ë™ë¡œ 85 íìŠ¤í…Œì´íŠ¸ ì—ì½” 3ì¸µ</span>
    <span>â“’ 2024 PPal-Ajoã…£All rights reserved.Designed for your convenience.</span>
</footer>
</body>
</html>