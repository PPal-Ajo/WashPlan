<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <link th:href="@{/css/base/nav.css}" rel="stylesheet">
    <link th:href="@{/css/mypage/mypage.css}" rel="stylesheet">
</head>
<body>
<!-- ë°°ê²½ ì´ë¯¸ì§€ -->
<img th:src="@{/images/main/mypage.png}" alt="mainpage" class="bg">

<header>
    <nav>
        <span>WashPlan</span>
        <span>ì˜ˆì•½</span>
        <span>FAQ</span>
        <span style="color: #FFFF00">ë§ˆì´í˜ì´ì§€</span>
        <span onclick="location.href='/login'">ë¡œê·¸ì•„ì›ƒ</span>
    </nav>
</header>

<main>
    <button class="info">íšŒì›ì •ë³´</button>
    <button class="reservation">ì˜ˆì•½í˜„í™©</button>
    <button class="inquiry">ë¬¸ì˜ë‚´ì—­</button>

    <button class="secession">íšŒì›íƒˆí‡´</button>

    <!-- ì•„ì´ë”” -->
    <p class="id">ì•„ì´ë””</p>
    <input class="idInput" th:value="${username}" readonly>

    <!-- ë¹„ë°€ë²ˆí˜¸ -->
    <p class="pwd">ë¹„ë°€ë²ˆí˜¸</p>
    <input id="passwordInput" class="pwdInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ëŠ” 8ìë¦¬ ì´ìƒ ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìê°€ ê° í•˜ë‚˜ì”© í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤." required>

    <button id="changePasswordButton" class="change">ë³€ê²½</button>

    <!-- ì´ë©”ì¼ -->
    <p class="email">ì´ë©”ì¼</p>
    <input class="emailInput" th:value="${email}" readonly>

    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ -->
    <p id="changePasswordMessage" style="display: none; color: red;"></p>
</main>

<footer>
    <span>ğŸ“031-123-4567ã…£âœ‰ï¸contact@washplan.com</span>
    <span>ğŸš©ê²½ê¸° í•˜ë‚¨ì‹œ ë¯¸ì‚¬ê°•ë³€ë™ë¡œ 85 íìŠ¤í…Œì´íŠ¸ ì—ì½” 3ì¸µ</span>
    <span>â“’ 2024 PPal-Ajoã…£All rights reserved.Designed for your convenience.</span>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const changePasswordButton = document.getElementById("changePasswordButton");
        const passwordInput = document.getElementById("passwordInput");
        const changePasswordMessage = document.getElementById("changePasswordMessage");

        changePasswordButton.addEventListener("click", function () {
            const newPassword = passwordInput.value;

            // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬
            if (newPassword.length < 8 || !/\d/.test(newPassword) || !/[!@#$%^&*]/.test(newPassword)) {
                changePasswordMessage.style.color = "red";
                changePasswordMessage.style.display = "block";
                changePasswordMessage.innerText = "ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                return;
            }

            // ì„œë²„ì— ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­ (AJAX)
            fetch('/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: newPassword })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        changePasswordMessage.style.color = "green";
                        changePasswordMessage.style.display = "block";
                        changePasswordMessage.innerText = "ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.";
                    } else {
                        changePasswordMessage.style.color = "red";
                        changePasswordMessage.style.display = "block";
                        changePasswordMessage.innerText = data.message || "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                    }
                })
                .catch(error => {
                    changePasswordMessage.style.color = "red";
                    changePasswordMessage.style.display = "block";
                    changePasswordMessage.innerText = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                });
        });
    });
</script>
</body>
</html>