<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <link th:href="@{/css/base/nav.css}" rel="stylesheet">
    <link th:href="@{/css/mypage/mypage.css}" rel="stylesheet">
</head>
<body>
<!-- 배경 이미지 -->
<img th:src="@{/images/main/mypage.png}" alt="mainpage" class="bg">

<header>
    <nav>
        <span>WashPlan</span>
        <span>예약</span>
        <span>FAQ</span>
        <span style="color: #FFFF00">마이페이지</span>
        <span onclick="location.href='/login'">로그아웃</span>
    </nav>
</header>

<main>
    <button class="info">회원정보</button>
    <button class="reservation">예약현황</button>
    <button class="inquiry">문의내역</button>

    <button class="secession">회원탈퇴</button>

    <!-- 아이디 -->
    <p class="id">아이디</p>
    <input class="idInput" th:value="${username}" readonly>

    <!-- 비밀번호 -->
    <p class="pwd">비밀번호</p>
    <input id="passwordInput" class="pwdInput" type="password" placeholder="비밀번호는 8자리 이상 영문, 숫자, 특수문자가 각 하나씩 포함되어야 합니다." required>

    <button id="changePasswordButton" class="change">변경</button>

    <!-- 이메일 -->
    <p class="email">이메일</p>
    <input class="emailInput" th:value="${email}" readonly>

    <!-- 비밀번호 변경 성공/실패 메시지 -->
    <p id="changePasswordMessage" style="display: none; color: red;"></p>
</main>

<footer>
    <span>📞031-123-4567ㅣ✉️contact@washplan.com</span>
    <span>🚩경기 하남시 미사강변동로 85 힐스테이트 에코 3층</span>
    <span>ⓒ 2024 PPal-AjoㅣAll rights reserved.Designed for your convenience.</span>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const changePasswordButton = document.getElementById("changePasswordButton");
        const passwordInput = document.getElementById("passwordInput");
        const changePasswordMessage = document.getElementById("changePasswordMessage");

        changePasswordButton.addEventListener("click", function () {
            const newPassword = passwordInput.value;

            // 클라이언트 측 유효성 검사
            if (newPassword.length < 8 || !/\d/.test(newPassword) || !/[!@#$%^&*]/.test(newPassword)) {
                changePasswordMessage.style.color = "red";
                changePasswordMessage.style.display = "block";
                changePasswordMessage.innerText = "사용 불가능한 비밀번호입니다.";
                return;
            }

            // 서버에 비밀번호 변경 요청 (AJAX)
            fetch('/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: newPassword })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        changePasswordMessage.style.color = "green";
                        changePasswordMessage.style.display = "block";
                        changePasswordMessage.innerText = "비밀번호가 성공적으로 변경되었습니다.";
                    } else {
                        changePasswordMessage.style.color = "red";
                        changePasswordMessage.style.display = "block";
                        changePasswordMessage.innerText = data.message || "비밀번호 변경에 실패했습니다.";
                    }
                })
                .catch(error => {
                    changePasswordMessage.style.color = "red";
                    changePasswordMessage.style.display = "block";
                    changePasswordMessage.innerText = "오류가 발생했습니다. 다시 시도해주세요.";
                });
        });
    });
</script>
</body>
</html>