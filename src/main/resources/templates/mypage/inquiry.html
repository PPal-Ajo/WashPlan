<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€</title>
  <link th:href="@{/css/base/nav.css}" rel="stylesheet">
  <link th:href="@{/css/mypage/inquiry.css}" rel="stylesheet">
</head>
<body>
<!-- ë°°ê²½ ì´ë¯¸ì§€ -->
<img th:src="@{/images/main/mypage.png}" alt="mainpage" class="bg">

<header>
  <nav>
      <span onclick="location.href='/'">WashPlan</span>
      <span onclick="location.href='/reservation'">ì˜ˆì•½</span>
      <span onclick="location.href='/faq'">FAQ</span>
      <span style="color: #FFFF00">ë§ˆì´í˜ì´ì§€</span>
      <span onclick="location.href='/login'">ë¡œê·¸ì•„ì›ƒ</span>
  </nav>
</header>

<main>
  <button class="info" onclick="location.href='/mypage'">íšŒì›ì •ë³´</button>
  <button class="reservation" onclick="location.href='/mypage/reservations'">ì˜ˆì•½í˜„í™©</button>
  <button class="inquiry" onclick="location.href='/mypage/inquiry'">ë¬¸ì˜ë‚´ì—­</button>

  <div class="nav-header">
    <p></p>
    <p class="timeNav">ë¬¸ì˜ë‚ ì§œ</p>
    <p class="optionNav">ë¬¸ì˜ì œëª©</p>
    <p class="replyNav">ë‹µë³€ìœ ë¬´</p>
  </div>
  <hr>

  <div class="inquiry-list">
    <!-- ë¬¸ì˜ë‚´ì—­ì´ ì—†ì„ ê²½ìš° í‘œì‹œí•  ë©”ì‹œì§€ -->
    <div th:if="${#lists.isEmpty(inquiries)}" class="no-inquiry-message">
        í˜„ì¬ ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
    </div>
    
    <!-- ë¬¸ì˜ë‚´ì—­ì´ ìˆì„ ê²½ìš° ëª©ë¡ í‘œì‹œ -->
    <div th:unless="${#lists.isEmpty(inquiries)}">
        <div th:each="inquiry : ${inquiries}" class="inquiry-item" th:data-inquiry-no="${inquiry.inquiryNo}">
            <span></span>
            <span class="inquiry-date" th:text="${#temporals.format(inquiry.inquiryDate, 'yyyy-MM-dd')}"></span>
            <span class="inquiry-title" th:text="${inquiry.inquiryTitle}"></span>
            <span class="inquiry-status" th:text="${inquiry.replyStatus}"></span>
        </div>
    </div>
  </div>

  <!-- ë¬¸ì˜ë‚´ì—­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
  <div id="inquiryDetailModal" class="modal">
      <div class="modal-content">
          <div class="inquiry-detail">
              <p><strong>ì œëª©</strong></p>
              <div id="modalTitle" class="content-box"></div>
              <p><strong>ë¬¸ì˜ë‚´ìš©</strong></p>
              <div id="modalContent" class="content-box"></div>
              <p><strong>ë‹µë³€</strong></p>
              <div id="modalReply" class="reply-box">
                  <p id="noReplyMessage" style="display: none;">
                      ê´€ë¦¬ìê°€ ë‹µë³€ì„ ì‘ì„±ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
                  </p>
                  <div id="replyContent" style="display: none;"></div>
              </div>
              <div class="modal-buttons">
                  <button class="delete-btn">ì‚­ì œ</button>
                  <button class="confirm-btn">í™•ì¸</button>
              </div>
          </div>
      </div>
  </div>

  <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
  <div id="deleteConfirmModal" class="modal">
      <div class="confirm-modal2">
          <div class="modal-message">
              <p>ì •ë§ë¡œ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
              <div class="modal-buttons">
                  <button class="cancel-btn">ì·¨ì†Œ</button>
                  <button class="confirm-delete-btn">í™•ì¸</button>
              </div>
          </div>
      </div>
  </div>

  <!-- ì‚­ì œ ì™„ë£Œ ëª¨ë‹¬ -->
  <div id="deleteCompleteModal" class="modal">
      <div class="confirm-modal2">
          <div class="modal-message">
              <p>ë¬¸ì˜ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
              <div class="modal-buttons">
                  <button class="complete-btn">í™•ì¸</button>
              </div>
          </div>
      </div>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì¶”ê°€ -->
  <div id="pagination" class="pagination">
      <button id="prevPage" disabled>â—€ï¸</button>
      <div id="pageNumbers"></div>
      <button id="nextPage" disabled>â–º</button>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('inquiryDetailModal');
      const deleteConfirmModal = document.getElementById('deleteConfirmModal');
      const deleteCompleteModal = document.getElementById('deleteCompleteModal');
      let currentInquiryNo = null;
      
      // ê° ë¬¸ì˜í•­ëª© í´ë¦­ ì´ë²¤íŠ¸
      document.querySelectorAll('.inquiry-item').forEach(item => {
          item.addEventListener('click', async function() {
              currentInquiryNo = this.getAttribute('data-inquiry-no');
              try {
                  const response = await fetch(`/inquiry/detail/${currentInquiryNo}`);
                  const data = await response.json();
                  
                  // ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸
                  document.getElementById('modalTitle').textContent = data.inquiryTitle;
                  document.getElementById('modalContent').textContent = data.inquiryContent;
                  
                  // ë‹µë³€ ì²˜ë¦¬
                  const noReplyMessage = document.getElementById('noReplyMessage');
                  const replyContent = document.getElementById('replyContent');
                  
                  if (data.replyComment) {
                      noReplyMessage.style.display = 'none';
                      replyContent.style.display = 'block';
                      replyContent.textContent = data.replyComment;
                  } else {
                      noReplyMessage.style.display = 'block';
                      replyContent.style.display = 'none';
                  }
                  
                  modal.style.display = 'block';
              } catch (error) {
                  console.error('Error:', error);
              }
          });
      });
      
      // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
      document.querySelector('.confirm-btn').addEventListener('click', function() {
          modal.style.display = 'none';
      });

      // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      document.querySelector('.delete-btn').addEventListener('click', function() {
          if (currentInquiryNo) {
              modal.style.display = 'none';
              deleteConfirmModal.style.display = 'block';
          }
      });

      // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ì˜ ì·¨ì†Œ ë²„íŠ¼
      document.querySelector('.cancel-btn').addEventListener('click', function() {
          deleteConfirmModal.style.display = 'none';
          modal.style.display = 'block';
      });

      // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
      document.querySelector('.confirm-delete-btn').addEventListener('click', async function() {
          try {
              const response = await fetch(`/inquiry/delete/${currentInquiryNo}`, {
                  method: 'DELETE',
                  headers: {
                      'Content-Type': 'application/json'
                  }
              });
              
              if (response.ok) {
                  deleteConfirmModal.style.display = 'none';
                  deleteCompleteModal.style.display = 'block';
              } else {
                  alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              }
          } catch (error) {
              console.error('Error:', error);
              alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
      });

      // ì‚­ì œ ì™„ë£Œ ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
      document.querySelector('.complete-btn').addEventListener('click', function() {
          deleteCompleteModal.style.display = 'none';
          location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      });

      // í˜ì´ì§€ë„¤ì´ì…˜ ê´€ë ¨ ë³€ìˆ˜
      const itemsPerPage = 5; // í˜ì´ì§€ë‹¹ ë³´ì—¬ì¤„ í•­ëª© ìˆ˜
      const inquiryItems = document.querySelectorAll('.inquiry-item');
      const totalPages = Math.ceil(inquiryItems.length / itemsPerPage);
      let currentPage = 1;

      // í˜ì´ì§€ ë²ˆí˜¸ ìƒì„±
      function createPageNumbers() {
          const pageNumbers = document.getElementById('pageNumbers');
          pageNumbers.innerHTML = '';
          
          for (let i = 1; i <= totalPages; i++) {
              const button = document.createElement('button');
              button.className = `page-number ${i === currentPage ? 'active' : ''}`;
              button.textContent = i;
              button.onclick = () => goToPage(i);
              pageNumbers.appendChild(button);
          }
      }

      // í˜ì´ì§€ ì´ë™
      function goToPage(page) {
          currentPage = page;
          updateDisplay();
          updateButtons();
          createPageNumbers();
      }

      // í™”ë©´ ì—…ë°ì´íŠ¸
      function updateDisplay() {
          const start = (currentPage - 1) * itemsPerPage;
          const end = start + itemsPerPage;

          inquiryItems.forEach((item, index) => {
              item.style.display = (index >= start && index < end) ? '' : 'none';
          });
      }

      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      function updateButtons() {
          document.getElementById('prevPage').disabled = currentPage === 1;
          document.getElementById('nextPage').disabled = currentPage === totalPages;
      }

      // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('prevPage').onclick = () => {
          if (currentPage > 1) goToPage(currentPage - 1);
      };

      document.getElementById('nextPage').onclick = () => {
          if (currentPage < totalPages) goToPage(currentPage + 1);
      };

      // ì´ˆê¸° ì„¤ì •
      createPageNumbers();
      updateDisplay();
      updateButtons();
  });
  </script>
</main>

<footer>
  <span>ğŸ“031-123-4567ã…£âœ‰ï¸contact@washplan.com</span>
  <span>ğŸš©ê²½ê¸° í•˜ë‚¨ì‹œ ë¯¸ì‚¬ê°•ë³€ë™ë¡œ 85 íìŠ¤í…Œì´íŠ¸ ì—ì½” 3ì¸µ</span>
  <span>â“’ 2024 PPal-Ajoã…£All rights reserved.Designed for your convenience.</span>
</footer>

</body>
</html>