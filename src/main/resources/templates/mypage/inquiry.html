<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>마이페이지</title>
  <link th:href="@{/css/base/nav.css}" rel="stylesheet">
  <link th:href="@{/css/mypage/inquiry.css}" rel="stylesheet">
</head>
<body>
<!-- 배경 이미지 -->
<img th:src="@{/images/main/mypage.png}" alt="mainpage" class="bg">

<header>
  <nav>
    <span onclick="location.href='/'">WashPlan</span>
    <span>예약</span>
    <span>FAQ</span>
    <span style="color: #FFFF00">마이페이지</span>
    <span onclick="location.href='/login'">로그아웃</span>
  </nav>
</header>

<main>
  <button class="info" onclick="location.href='/mypage'">회원정보</button>
  <button class="reservation" onclick="location.href='/mypage/reservations'">예약현황</button>
  <button class="inquiry" onclick="location.href='/mypage/inquiry'">문의내역</button>

  <div class="nav-header">
    <p class="machineNav">번호</p>
    <p class="timeNav">문의날짜</p>
    <p class="optionNav">문의제목</p>
    <p class="replyNav">답변유무</p>
  </div>
  <hr>

  <div class="inquiry-list">
    <div th:each="inquiry : ${inquiries}" class="inquiry-item" th:data-inquiry-no="${inquiry.inquiryNo}">
        <span class="inquiry-no" th:text="${inquiry.inquiryNo}"></span>
        <span class="inquiry-date" th:text="${#temporals.format(inquiry.inquiryDate, 'yyyy-MM-dd')}"></span>
        <span class="inquiry-title" th:text="${inquiry.inquiryTitle}"></span>
        <span class="inquiry-status" th:text="${inquiry.replyStatus}"></span>
    </div>
  </div>

  <!-- 문의내역 상세보기 모달 -->
  <div id="inquiryDetailModal" class="modal">
      <div class="modal-content">
          <div class="inquiry-detail">
              <p><strong>제목</strong></p>
              <div id="modalTitle" class="content-box"></div>
              <p><strong>문의내용</strong></p>
              <div id="modalContent" class="content-box"></div>
              <p><strong>답변</strong></p>
              <div id="modalReply" class="reply-box">
                  <p id="noReplyMessage" style="display: none;">
                      관리자가 답변을 작성중입니다. 잠시만 기다려주세요.
                  </p>
                  <div id="replyContent" style="display: none;"></div>
              </div>
              <div class="modal-buttons">
                  <button class="delete-btn">삭제</button>
                  <button class="confirm-btn">확인</button>
              </div>
          </div>
      </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('inquiryDetailModal');
      
      // 각 문의항목 클릭 이벤트
      document.querySelectorAll('.inquiry-item').forEach(item => {
          item.addEventListener('click', async function() {
              const inquiryNo = this.getAttribute('data-inquiry-no');
              try {
                  const response = await fetch(`/inquiry/detail/${inquiryNo}`);
                  const data = await response.json();
                  
                  // 모달 내용 업데이트
                  document.getElementById('modalTitle').textContent = data.inquiryTitle;
                  document.getElementById('modalContent').textContent = data.inquiryContent;
                  
                  // 답변 처리
                  const noReplyMessage = document.getElementById('noReplyMessage');
                  const replyContent = document.getElementById('replyContent');
                  
                  if (data.replyComment) {
                      noReplyMessage.style.display = 'none';
                      replyContent.style.display = 'block';
                      replyContent.textContent = data.replyComment;
                  } else {
                      noReplyMessage.style.display = 'block';
                      replyContent.style.display = 'none';
                  }
                  
                  modal.style.display = 'block';
              } catch (error) {
                  console.error('Error:', error);
              }
          });
      });
      
      // 확인 버튼 클릭 시 모달 닫기
      document.querySelector('.confirm-btn').addEventListener('click', function() {
          modal.style.display = 'none';
      });

      // 삭제 버튼 클릭 이벤트 (나중에 구현)
      document.querySelector('.delete-btn').addEventListener('click', function() {
          console.log('삭제 기능은 아직 구현되지 않았습니다.');
      });
  });
  </script>
</main>

<footer>
  <span>📞031-123-4567ㅣ✉️contact@washplan.com</span>
  <span>🚩경기 하남시 미사강변동로 85 힐스테이트 에코 3층</span>
  <span>ⓒ 2024 PPal-AjoㅣAll rights reserved.Designed for your convenience.</span>
</footer>

</body>
</html>