<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€</title>
  <link th:href="@{/css/base/nav.css}" rel="stylesheet">
  <link th:href="@{/css/mypage/reservation.css}" rel="stylesheet">
</head>
<body>
<!-- ë°°ê²½ ì´ë¯¸ì§€ -->
<img th:src="@{/images/main/mypage.png}" alt="mainpage" class="bg">

<header>
  <nav>
    <span>WashPlan</span>
    <span>ì˜ˆì•½</span>
    <span>FAQ</span>
    <span style="color: #FFFF00">ë§ˆì´í˜ì´ì§€</span>
    <span onclick="location.href='/login'">ë¡œê·¸ì•„ì›ƒ</span>
  </nav>
</header>

<main>
  <button class="info" onclick="location.href='/mypage'">íšŒì›ì •ë³´</button>
  <button class="reservation">ì˜ˆì•½í˜„í™©</button>
  <button class="inquiry" onclick="location.href='/mypage/inquiry'">ë¬¸ì˜ë‚´ì—­</button>

  <div class="nav-header">
    <p class="machineNav">ê¸°ê¸°</p>
    <p class="timeNav">ì˜ˆì•½ì‹œê°„</p>
    <p class="optionNav">ì˜µì…˜</p>
    <p class="priceNav">ê°€ê²©</p>
  </div>
  <hr>

  <div class="content-container">
    <div th:if="${#lists.isEmpty(reservations)}">
      <p class="noReservation">í˜„ì¬ ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <div th:if="${!#lists.isEmpty(reservations)}" class="reservation-list">
      <div th:each="reservation : ${reservations}" class="reservation-row">
        <span class="machine-col" th:text="${reservation.machineNo}"></span>
        <span class="time-col">
          <span th:text="${#temporals.format(reservation.reserveDate, 'MM/dd(E)')}"></span>
          <span th:text="${#temporals.format(reservation.startTime, 'HH:mm')}"></span>
        </span>
        <span class="option-col" th:text="${reservation.reserveOption}"></span>
        <span class="price-col" th:text="${reservation.reservePrice + 'ì›'}"></span>
        <div class="button-container">
          <button class="cancel-btn" th:data-reserve-no="${reservation.reserveNo}">ì·¨ì†Œ</button>
          <button class="qr-btn">QR</button>
        </div>
      </div>
    </div>
  </div>

  <div id="pagination" class="pagination">
    <button id="prevPage" disabled>â—€ï¸</button>
    <div id="pageNumbers"></div>
    <button id="nextPage" disabled>â–º</button>
  </div>
</main>

<footer>
  <span>ğŸ“031-123-4567ã…£âœ‰ï¸contact@washplan.com</span>
  <span>ğŸš©ê²½ê¸° í•˜ë‚¨ì‹œ ë¯¸ì‚¬ê°•ë³€ë™ë¡œ 85 íìŠ¤í…Œì´íŠ¸ ì—ì½” 3ì¸µ</span>
  <span>â“’ 2024 PPal-Ajoã…£All rights reserved.Designed for your convenience.</span>
</footer>

<!-- ì˜ˆì•½ ì·¨ì†Œ í™•ì¸ ëª¨ë‹¬ -->
<div id="cancelConfirmModal" class="modal">
    <div class="modal-content">
        <p class="modal-text">ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <div class="modal-buttons">
            <button id="cancelButton" class="modal-button cancel">ì·¨ì†Œ</button>
            <button id="confirmButton" class="modal-button confirm">í™•ì¸</button>
        </div>
    </div>
</div>

<!-- ì˜ˆì•½ ì·¨ì†Œ ì™„ë£Œ ëª¨ë‹¬ -->
<div id="cancelCompleteModal" class="modal">
    <div class="modal-content">
        <p class="modal-text">ì˜ˆì•½ ì·¨ì†Œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        <div class="modal-buttons">
            <button id="completeButton" class="modal-button confirm">í™•ì¸</button>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const itemsPerPage = 4; // í˜ì´ì§€ë‹¹ í‘œì‹œí•  í•­ëª© ìˆ˜
    let currentPage = 1;
    let totalPages = 1;
    
    function updatePagination() {
        const reservationItems = document.querySelectorAll('.reservation-row');
        totalPages = Math.ceil(reservationItems.length / itemsPerPage);
        
        // í˜ì´ì§€ ë²ˆí˜¸ ìƒì„±
        const pageNumbersDiv = document.getElementById('pageNumbers');
        pageNumbersDiv.innerHTML = '';
        
        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            pageButton.classList.add('page-number');
            if (i === currentPage) {
                pageButton.classList.add('active');
            }
            pageButton.addEventListener('click', () => goToPage(i));
            pageNumbersDiv.appendChild(pageButton);
        }
        
        // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
        
        // í•­ëª© í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
        reservationItems.forEach((item, index) => {
            if (index >= (currentPage - 1) * itemsPerPage && index < currentPage * itemsPerPage) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    function goToPage(page) {
        currentPage = page;
        updatePagination();
        
        // í˜„ì¬ í˜ì´ì§€ ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.page-number').forEach(btn => {
            btn.classList.remove('active');
            if (parseInt(btn.textContent) === page) {
                btn.classList.add('active');
            }
        });
    }
    
    // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            goToPage(currentPage - 1);
        }
    });
    
    // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
    document.getElementById('nextPage').addEventListener('click', () => {
        if (currentPage < totalPages) {
            goToPage(currentPage + 1);
        }
    });
    
    // ì´ˆê¸° í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì •
    updatePagination();
});

document.addEventListener('DOMContentLoaded', function() {
    const cancelConfirmModal = document.getElementById('cancelConfirmModal');
    const cancelCompleteModal = document.getElementById('cancelCompleteModal');
    const cancelButton = document.getElementById('cancelButton');
    const confirmButton = document.getElementById('confirmButton');
    const completeButton = document.getElementById('completeButton');
    let selectedReserveNo = null;

    // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('.cancel-btn').forEach(button => {
        button.addEventListener('click', function() {
            selectedReserveNo = this.getAttribute('data-reserve-no');
            cancelConfirmModal.style.display = 'block';
        });
    });

    // ëª¨ë‹¬ì˜ ì·¨ì†Œ ë²„íŠ¼
    cancelButton.addEventListener('click', function() {
        cancelConfirmModal.style.display = 'none';
    });

    // ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
    confirmButton.addEventListener('click', async function() {
        try {
            const response = await fetch('/mypage/reservations/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reserveNo: parseInt(selectedReserveNo, 10) })
            });

            const result = await response.json();

            if (result.success === "true") {
                cancelConfirmModal.style.display = 'none';
                cancelCompleteModal.style.display = 'block';
            } else {
                alert(result.message);
            }
        } catch (error) {
            console.error('ì˜ˆì•½ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            alert('ì˜ˆì•½ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });

    // ì™„ë£Œ ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
    completeButton.addEventListener('click', function() {
        cancelCompleteModal.style.display = 'none';
        location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    });
});
</script>
</body>
</html>